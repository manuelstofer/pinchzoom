(function(){var g=function(e){var f=function(a,b){this.el=e(a);this.lastScale=this.zoomFactor=1;this.offset={x:0,y:0};this.options=e.extend({},this.defaults,b);this.setupMarkup();this.bindEvents();this.update();this.enable()},g=function(a,b){return a+b};f.prototype={defaults:{tapZoomFactor:2,zoomOutFactor:1.3,animationDuration:300,maxZoom:4,minZoom:0.5,lockDragAxis:!1,use2d:!0,zoomStartEventName:"pz_zoomstart",zoomEndEventName:"pz_zoomend",dragStartEventName:"pz_dragstart",dragEndEventName:"pz_dragend",
doubleTapEventName:"pz_doubletap",cancelNonInteractionEvents:!1},handleDragStart:function(a){this.el.trigger(this.options.dragStartEventName);this.stopAnimation();this.lastDragPosition=!1;this.hasInteraction=!0;this.handleDrag(a)},handleDrag:function(a){1<this.zoomFactor&&(a=this.getTouches(a)[0],this.drag(a,this.lastDragPosition),this.offset=this.sanitizeOffset(this.offset),this.lastDragPosition=a)},handleDragEnd:function(){this.el.trigger(this.options.dragEndEventName);this.end()},handleZoomStart:function(a){this.el.trigger(this.options.zoomStartEventName);
this.stopAnimation();this.lastScale=1;this.nthZoom=0;this.lastZoomCenter=!1;this.hasInteraction=!0},handleZoom:function(a,b){var c=this.getTouchCenter(this.getTouches(a)),d=b/this.lastScale;this.lastScale=b;this.nthZoom+=1;3<this.nthZoom&&(this.scale(d,c),this.drag(c,this.lastZoomCenter));this.lastZoomCenter=c},handleZoomEnd:function(){this.el.trigger(this.options.zoomEndEventName);this.end()},handleDoubleTap:function(a){var b=this.getTouches(a)[0],c=1<this.zoomFactor?1:this.options.tapZoomFactor,
d=this.zoomFactor;a=function(a){this.scaleTo(d+a*(c-d),b)}.bind(this);this.hasInteraction||(d>c&&(b=this.getCurrentZoomCenter()),this.animate(this.options.animationDuration,a,this.swing),this.el.trigger(this.options.doubleTapEventName))},sanitizeOffset:function(a){var b=(this.zoomFactor-1)*this.getContainerX(),c=(this.zoomFactor-1)*this.getContainerY(),d=Math.max(b,0),t=Math.max(c,0),b=Math.min(b,0),c=Math.min(c,0);return{x:Math.min(Math.max(a.x,b),d),y:Math.min(Math.max(a.y,c),t)}},scaleTo:function(a,
b){this.scale(a/this.zoomFactor,b)},scale:function(a,b){a=this.scaleZoomFactor(a);this.addOffset({x:(a-1)*(b.x+this.offset.x),y:(a-1)*(b.y+this.offset.y)})},scaleZoomFactor:function(a){var b=this.zoomFactor;this.zoomFactor*=a;this.zoomFactor=Math.min(this.options.maxZoom,Math.max(this.zoomFactor,this.options.minZoom));return this.zoomFactor/b},drag:function(a,b){b&&(this.options.lockDragAxis?Math.abs(a.x-b.x)>Math.abs(a.y-b.y)?this.addOffset({x:-(a.x-b.x),y:0}):this.addOffset({y:-(a.y-b.y),x:0}):
this.addOffset({y:-(a.y-b.y),x:-(a.x-b.x)}))},getTouchCenter:function(a){return this.getVectorAvg(a)},getVectorAvg:function(a){return{x:a.map(function(a){return a.x}).reduce(g)/a.length,y:a.map(function(a){return a.y}).reduce(g)/a.length}},addOffset:function(a){this.offset={x:this.offset.x+a.x,y:this.offset.y+a.y}},sanitize:function(){this.zoomFactor<this.options.zoomOutFactor?this.zoomOutAnimation():this.isInsaneOffset(this.offset)&&this.sanitizeOffsetAnimation()},isInsaneOffset:function(a){var b=
this.sanitizeOffset(a);return b.x!==a.x||b.y!==a.y},sanitizeOffsetAnimation:function(){var a=this.sanitizeOffset(this.offset),b=this.offset.x,c=this.offset.y,d=function(d){this.offset.x=b+d*(a.x-b);this.offset.y=c+d*(a.y-c);this.update()}.bind(this);this.animate(this.options.animationDuration,d,this.swing)},zoomOutAnimation:function(){var a=this.zoomFactor,b=this.getCurrentZoomCenter(),c=function(c){this.scaleTo(a+c*(1-a),b)}.bind(this);this.animate(this.options.animationDuration,c,this.swing)},updateAspectRatio:function(){this.setContainerY(this.getContainerX()/
this.getAspectRatio())},getInitialZoomFactor:function(){return this.container[0].offsetWidth/this.el[0].offsetWidth},getAspectRatio:function(){return this.el[0].offsetWidth/this.el[0].offsetHeight},getCurrentZoomCenter:function(){var a=this.offset.x,b=this.container[0].offsetWidth*this.zoomFactor-a-this.container[0].offsetWidth,a=a/b,a=a*this.container[0].offsetWidth/(a+1),c=this.offset.y,d=this.container[0].offsetHeight*this.zoomFactor-c-this.container[0].offsetHeight,c=c/d,c=c*this.container[0].offsetHeight/
(c+1);0===b&&(a=this.container[0].offsetWidth);0===d&&(c=this.container[0].offsetHeight);return{x:a,y:c}},canDrag:function(){var a=this.zoomFactor;return!(0.99<a&&1.01>a)},getTouches:function(a){var b=this.container.offset();return Array.prototype.slice.call(a.touches).map(function(a){return{x:a.pageX-b.left,y:a.pageY-b.top}})},animate:function(a,b,c,d){var e=(new Date).getTime(),f=function(){if(this.inAnimation){var k=(new Date).getTime()-e,l=k/a;k>=a?(b(1),d&&d(),this.update(),this.stopAnimation(),
this.update()):(c&&(l=c(l)),b(l),this.update(),requestAnimationFrame(f))}}.bind(this);this.inAnimation=!0;requestAnimationFrame(f)},stopAnimation:function(){this.inAnimation=!1},swing:function(a){return-Math.cos(a*Math.PI)/2+0.5},getContainerX:function(){return this.container[0].offsetWidth},getContainerY:function(){return this.container[0].offsetHeight},setContainerY:function(a){return this.container.height(a)},setupMarkup:function(){this.container=e('<div class="pinch-zoom-container"></div>');this.el.before(this.container);
this.container.append(this.el);this.container.css({overflow:"hidden",position:"relative"});this.el.css({"-webkit-transform-origin":"0% 0%","-moz-transform-origin":"0% 0%","-ms-transform-origin":"0% 0%","-o-transform-origin":"0% 0%","transform-origin":"0% 0%",position:"absolute"})},end:function(){this.hasInteraction=!1;this.sanitize();this.update()},bindEvents:function(){q(this.container.get(0),this);e(window).on("resize",this.update.bind(this));e(this.el).find("img").on("load",this.update.bind(this))},
update:function(){this.updatePlaned||(this.updatePlaned=!0,setTimeout(function(){this.updatePlaned=!1;this.updateAspectRatio();var a=this.getInitialZoomFactor()*this.zoomFactor,b=-this.offset.x/a,c=-this.offset.y/a,d="scale3d("+a+", "+a+",1) translate3d("+b+"px,"+c+"px,0px)",a="scale("+a+", "+a+") translate("+b+"px,"+c+"px)",b=function(){this.clone&&(this.clone.remove(),delete this.clone)}.bind(this);!this.options.use2d||this.hasInteraction||this.inAnimation?(this.is3d=!0,b(),this.el.css({"-webkit-transform":d,
"-o-transform":a,"-ms-transform":a,"-moz-transform":a,transform:d})):(this.is3d&&(this.clone=this.el.clone(),this.clone.css("pointer-events","none"),this.clone.appendTo(this.container),setTimeout(b,200)),this.el.css({"-webkit-transform":a,"-o-transform":a,"-ms-transform":a,"-moz-transform":a,transform:a}),this.is3d=!1)}.bind(this),0))},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1}};var q=function(a,b){var c=null,d=0,e=null,f=null,k=function(a,d){if(c!==a){if(c&&!a)switch(c){case "zoom":b.handleZoomEnd(d);
break;case "drag":b.handleDragEnd(d)}switch(a){case "zoom":b.handleZoomStart(d);break;case "drag":b.handleDragStart(d)}}c=a},l=function(a){2===d?k("zoom"):1===d&&b.canDrag()?k("drag",a):k(null,a)},g=function(a){return Array.prototype.slice.call(a).map(function(a){return{x:a.pageX,y:a.pageY}})},s=function(a,b){var c,d;c=a.x-b.x;d=a.y-b.y;return Math.sqrt(c*c+d*d)},q=function(a,b){var c=s(a[0],a[1]);return s(b[0],b[1])/c},h=function(a){a.stopPropagation();a.preventDefault()},r=!0;a.addEventListener("touchstart",
function(a){if(b.enabled){r=!0;d=a.touches.length;var f=(new Date).getTime();1<d&&(e=null);if(300>f-e)switch(h(a),b.handleDoubleTap(a),c){case "zoom":b.handleZoomEnd(a);break;case "drag":b.handleDragEnd(a)}1===d&&(e=f)}});a.addEventListener("touchmove",function(a){if(b.enabled){if(r)l(a),(c||b.options.cancelNonInteractionEvents)&&h(a),f=g(a.touches);else{switch(c){case "zoom":b.handleZoom(a,q(f,g(a.touches)));break;case "drag":b.handleDrag(a)}(c||b.options.cancelNonInteractionEvents)&&h(a);c&&b.update()}r=
!1}});a.addEventListener("touchend",function(a){b.enabled&&(d=a.touches.length,l(a))});var m=1;a.addEventListener("mousewheel",function(a){if(b.enabled){var c=Math.max(-1,Math.min(1,a.wheelDelta||-a.detail));m+=c;2>m?(m=1,b.zoomOutAnimation()):b.scale(m,{x:a.offsetX,y:a.offsetY});b.update();h(a)}});var n,p;a.addEventListener("mousedown",function(c){if(b.enabled&&b.canDrag()){n=c.pageX;p=c.pageY;var d=function(b){n=b.pageX;p=b.pageY;a.removeEventListener("mousemove",d);h(b)};a.addEventListener("mousemove",
d);var e=function(c){if(n!=c.pageX||p!=c.pageY)b.addOffset({x:n-c.pageX,y:p-c.pageY}),b.update();a.removeEventListener("mouseup",e);h(c)};a.addEventListener("mouseup",e);h(c)}})};return f};"undefined"!==typeof define&&define.amd?define(["jquery"],function(e){return g(e)}):(window.RTP=window.RTP||{},window.RTP.PinchZoom=g(window.$));(function(e){e.fn.pinchzoom=function(e){e=e||{};return this.each(function(){new RTP.PinchZoom(this,e)})}})(jQuery)}).call(this);
